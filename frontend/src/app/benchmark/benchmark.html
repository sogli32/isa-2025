<div class="benchmark-container">
  <h1>ğŸ“Š Benchmark - Trending Performanse</h1>
  <p class="subtitle">
    [S2] Testiranje optimalne mere izmeÄ‘u performansi i trendinga u realnom vremenu
  </p>

  <!-- ==================== GEOLOKACIJA SEKCIJA ==================== -->
  <section class="location-section">
    <h2>ğŸ“ Lokacija korisnika</h2>
    <p class="section-desc">
      [S2] ZatraÅ¾iti lokaciju od korisnika, u sluÄaju da odbije, koristiti aproksimaciju lokacije sa koje je upuÄ‡en zahtev.
    </p>

    <div *ngIf="locationLoading" class="loading-inline">
      <span class="spinner-small"></span> Dobijanje lokacije...
    </div>

    <div *ngIf="locationError" class="error-inline">
      âš ï¸ {{ locationError }}
    </div>

    <div *ngIf="userLocation && !locationLoading" class="location-info">
      <div class="location-badge" [class.approximate]="userLocation.approximate">
        {{ getLocationSourceLabel() }}
      </div>

      <div class="location-details">
        <div class="detail" *ngIf="userLocation.latitude && userLocation.longitude">
          <span class="label">Koordinate:</span>
          <span class="value">{{ userLocation.latitude?.toFixed(4) }}, {{ userLocation.longitude?.toFixed(4) }}</span>
        </div>
        <div class="detail" *ngIf="userLocation.city">
          <span class="label">Grad:</span>
          <span class="value">{{ userLocation.city }}</span>
        </div>
        <div class="detail" *ngIf="userLocation.country">
          <span class="label">DrÅ¾ava:</span>
          <span class="value">{{ userLocation.country }}</span>
        </div>
        <div class="detail">
          <span class="label">Preciznost:</span>
          <span class="value" [class.warning]="userLocation.approximate">
            {{ userLocation.approximate ? 'âš ï¸ PribliÅ¾na (IP)' : 'âœ… Precizna (GPS)' }}
          </span>
        </div>
      </div>

      <button class="btn-secondary" (click)="refreshLocation()">
        ğŸ”„ OsveÅ¾i lokaciju
      </button>
    </div>
  </section>

  <!-- ==================== BENCHMARK KONTROLE ==================== -->
  <section class="benchmark-controls">
    <h2>âš¡ Benchmark parametri</h2>

    <div class="params">
      <div class="param">
        <label for="iterations">Broj iteracija:</label>
        <input 
          type="number" 
          id="iterations" 
          [(ngModel)]="iterations" 
          min="10" 
          max="1000"
        />
      </div>

      <div class="param">
        <label for="limit">Trending limit:</label>
        <input 
          type="number" 
          id="limit" 
          [(ngModel)]="limit" 
          min="1" 
          max="100"
        />
      </div>
    </div>

    <div class="buttons">
      <button 
        class="btn-primary" 
        (click)="runBenchmark()" 
        [disabled]="loading"
      >
        {{ loading ? 'Testiram...' : 'ğŸš€ Pokreni benchmark' }}
      </button>

      <button 
        class="btn-secondary" 
        (click)="runQuickBenchmark()" 
        [disabled]="loading"
      >
        âš¡ Brzi test (20 iteracija)
      </button>
    </div>

    <div *ngIf="loading" class="loading">
      <div class="spinner"></div>
      <p>Benchmark u toku... Ovo moÅ¾e potrajati nekoliko sekundi.</p>
    </div>

    <div *ngIf="error" class="error">
      {{ error }}
    </div>
  </section>

  <!-- ==================== REZULTATI ==================== -->
  <section *ngIf="report" class="results-section">
    <h2>ğŸ“ˆ Rezultati benchmarka</h2>

    <div class="meta-info">
      <span>ğŸ• {{ formatTimestamp(report.timestamp) }}</span>
      <span>ğŸ¬ {{ report.totalVideosInDatabase }} videa u bazi</span>
      <span>ğŸ”„ {{ report.iterationsPerStrategy }} iteracija po strategiji</span>
    </div>

    <!-- Tabela rezultata -->
    <div class="table-container">
      <table class="results-table">
        <thead>
          <tr>
            <th>Strategija</th>
            <th>Avg (ms)</th>
            <th>Min (ms)</th>
            <th>Max (ms)</th>
            <th>Median (ms)</th>
            <th>P95 (ms)</th>
            <th>P99 (ms)</th>
            <th>StdDev</th>
            <th>Speedup</th>
          </tr>
        </thead>
        <tbody>
          <tr 
            *ngFor="let result of report.results" 
            [class]="getStrategyClass(result.strategyName)"
          >
            <td class="strategy-name">
              <span class="name">{{ result.strategyName }}</span>
              <span class="badge" *ngIf="result.strategyName === report.optimalStrategy">
                â­ OPTIMAL
              </span>
              <span class="realtime-badge" *ngIf="result.isRealTime">
                ğŸ”´ Real-time
              </span>
            </td>
            <td class="avg">{{ result.avgResponseTimeMs }}</td>
            <td>{{ result.minResponseTimeMs }}</td>
            <td>{{ result.maxResponseTimeMs }}</td>
            <td>{{ result.medianResponseTimeMs }}</td>
            <td>{{ result.p95ResponseTimeMs }}</td>
            <td>{{ result.p99ResponseTimeMs }}</td>
            <td>{{ result.standardDeviation }}</td>
            <td class="speedup">{{ getSpeedup(result) }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Opisi strategija -->
    <div class="strategy-descriptions">
      <div *ngFor="let result of report.results" class="strategy-desc">
        <strong>{{ result.strategyName }}:</strong> {{ result.description }}
      </div>
    </div>

    <!-- Grafovi -->
    <div class="charts">
      <div class="chart-container">
        <canvas #responseTimeChart></canvas>
      </div>

      <div class="chart-container">
        <canvas #comparisonChart></canvas>
      </div>
    </div>

    <!-- Preporuka -->
    <div class="recommendation">
      <h3>ğŸ’¡ Preporuka</h3>
      <div class="optimal-strategy">
        Optimalna strategija: <strong>{{ report.optimalStrategy }}</strong>
      </div>
      <p class="recommendation-text">{{ report.recommendation }}</p>
    </div>
  </section>
</div>
